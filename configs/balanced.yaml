# Pipelock config â€” balanced preset
# Capability separation: agent has secrets but restricted network,
# fetch proxy has full internet but no secrets.
#
# Use this for: most developers and companies running AI agents.
# Blocks naive attacks, detects sophisticated ones, logs everything.

version: 1
mode: balanced

api_allowlist:
  - "*.anthropic.com"
  - "*.openai.com"
  - "api.telegram.org"
  - "*.discord.com"
  - "gateway.discord.gg"
  - "*.slack.com"
  - "github.com"
  - "*.github.com"
  - "*.githubusercontent.com"
  - "registry.npmjs.org"

fetch_proxy:
  listen: "127.0.0.1:8888"
  timeout_seconds: 30
  max_response_mb: 10
  user_agent: "Pipelock Fetch/1.0"
  monitoring:
    max_url_length: 2048
    # Shannon entropy bits per character. Typical ranges:
    #   English/slugs: ~3.5-4.0 | hex (commit hashes): ~4.0
    #   base64: ~4.0-4.5 | random/encrypted: ~5.5-8.0
    # 4.5 catches random strings while allowing most base64 and hex.
    # Use 3.5 (strict) to also catch base64-encoded secrets.
    entropy_threshold: 4.5
    max_requests_per_minute: 60
    blocklist:
      - "*.pastebin.com"
      - "*.hastebin.com"
      - "*.paste.ee"
      - "*.transfer.sh"
      - "*.file.io"
      - "*.requestbin.com"

dlp:
  scan_env: true
  patterns:
    - name: "Anthropic API Key"
      regex: 'sk-ant-[a-zA-Z0-9\-_]{20,}'
      severity: critical
    - name: "OpenAI API Key"
      regex: 'sk-[a-zA-Z0-9]{20,}'
      severity: critical
    - name: "GitHub Token"
      regex: 'gh[ps]_[A-Za-z0-9_]{36,}'
      severity: critical
    - name: "Slack Token"
      regex: 'xox[bpras]-[0-9a-zA-Z-]+'
      severity: critical
    - name: "AWS Access Key"
      regex: 'AKIA[0-9A-Z]{16}'
      severity: critical
    - name: "Discord Bot Token"
      regex: '[MN][A-Za-z0-9]{23,}\.[A-Za-z0-9\-_]{6}\.[A-Za-z0-9\-_]{27,}'
      severity: critical
    - name: "Private Key Header"
      regex: '-----BEGIN\s+(RSA\s+|EC\s+|DSA\s+)?PRIVATE\s+KEY-----'
      severity: critical
    - name: "Social Security Number"
      regex: '\b\d{3}-\d{2}-\d{4}\b'
      severity: high

logging:
  format: json
  output: stdout
  include_allowed: true
  include_blocked: true

internal:
  - "127.0.0.0/8"
  - "10.0.0.0/8"
  - "172.16.0.0/12"
  - "192.168.0.0/16"
  - "169.254.0.0/16"
  - "::1/128"
  - "fc00::/7"
  - "fe80::/10"
  - "::ffff:0:0/96"
